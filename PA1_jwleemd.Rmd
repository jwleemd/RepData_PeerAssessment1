---
title: "Reproducible Research: Peer Assessment 1"
output: 
html_document:
keep_md: true
---


## Loading and preprocessing the data

```{r, echo=TRUE}

activity_data <- read.csv("activity.csv")
```

## What is mean total number of steps taken per day?

```{r, echo=TRUE}
total_steps_per_day <- aggregate(steps~date, data=activity_data, FUN=sum)
hist(total_steps_per_day$steps, 
     main="Histogram of total number of steps per day",
     ylim = c(0,30),
     xlab="Total number of steps per day")
mean(total_steps_per_day$steps)
median(total_steps_per_day$steps)
```

## What is the average daily activity pattern?
```{r, echo=TRUE}

average_steps_per_interval <- aggregate(steps ~ interval, 
                                        data=activity_data, 
                                        FUN=mean, na.rm=T)

plot(steps ~ interval, data=average_steps_per_interval, type="l")
average_steps_per_interval$interval[which.max(average_steps_per_interval$steps)]

```

## Imputing missing values

#Calculate and report the total number of missing values in the dataset

```{r, echo=TRUE}
sum(apply(activity_data, 1, function(x) any(is.na(x))))
```
#Devise a strategy for filling in all of the missing values in the dataset. The strategy does not need to be sophisticated. For example, you could use the mean/median for that day, or the mean for that 5-minute interval, etc.

#In the following code, the missing values are being replaced by the mean for that 5-minute interval.

```{r, echo=TRUE}
old <- activity_data
for (i in 1:nrow(activity_data)) {
        
        if (is.na(activity_data[i,"steps"])) {
                
                activity_data[i, "steps"] <- average_steps_per_interval$steps[average_steps_per_interval$interval == activity_data[i, "interval"]]
                
        }
}
activity_data_new <- activity_data
activity_data_old <- old

total_steps_per_day_new <- aggregate(steps~date, data=activity_data_new, FUN=sum)
hist(total_steps_per_day_new$steps, 
     main="Histogram of total number of steps per day",
     ylim = c(0,40),
     xlab="Total number of steps per day")
mean(total_steps_per_day_new$steps)
median(total_steps_per_day_new$steps)

```

## Are there differences in activity patterns between weekdays and weekends?
```{r, echo = TRUE}
steps_per_day$weekdays <- factor(weekdays(as.Date(mean_steps_per_day$date)))
means_for_each_weekday <- aggregate(steps ~ weekdays, data=mean_steps_per_day, FUN=mean)
sd_for_each_weekday <- aggregate(steps ~ weekdays, data=steps_per_day, FUN=sd)
names(means_for_each_weekday) <- c("Weekdays","Mean")
names(sd_for_each_weekday) <- c("Weekdays", "Sd")
means_and_sds_for_each_weekday <- merge(x=means_for_each_weekday, y=sd_for_each_weekday, by="Weekdays")
means_and_sds_for_each_weekday$t <- factor(means_and_sds_for_each_weekday$Weekdays,
                                           levels=c("Sunday", "Monday", "Tuesday", "Wednesday",
                                                    "Thursday", "Friday", "Saturday"))

require(ggplot2)
ggplot(means_and_sds_for_each_weekday, aes(x=t, y=Mean)) + 
        geom_bar(stat="identity") + 
        labs(x="Weekdays", y="Mean steps per day")
```